# 1. Compounding
### Def 1.1 (Present and Future Values)
Define the following:
- Discrete time $t \in \{0, 1, 2, \dots \}$,
- One period compounding - the interest is compounded every year,
- $PV$ - present value,
- $FV$ - future value,
- $r$ - interest rate (e.g. $5\%$).
Then for $t=1$:
$$
FV = PV + rPV = PV(1+r),
$$
for $t=2$:
$$
FV = (1+r)(1+r)PV = PV(1+r)^2,
$$
for $t=n$:
$$
FV = PV(1+r)^n.
$$
### Def 1.2 (Frequent compounding)
Let $f$ be the number of times that interest rate is calculated within a unit time. For example, if we do it every third month, then $f=4$. We have
$$
FV = PV\left(1 + \frac{r}{f}\right)^{nf}.
$$
If we let $f \rightarrow \infty$, so that $nf -> t$, we get the continuous compounding formula
$$
FV = PVe^{rt}.
$$
### Def 1.3 (Discounting)
Discounting works the other way around:
$$
PV = FV\left(1 + \frac{r}{f}\right)^{-nf},
$$
and for the continuous case:
$$
PV = FVe^{-rt}.
$$
### Def 1.4 (Risk-Free Instrument)
A risk-free instrument is defined by
$$
B_t = B_0e^{rt},
$$
where $r$ is a risk-free interest rate. For discrete time we have
$$
B_n = B_0\left(1 + \frac{r}{f}\right)^{nf}.
$$
#### The goal
We want to find the fair price of some financial instrument/derivative, which is often defined with a function (called a payout function) of the asset price. For example, in the european call option
$$
C_T = (S_T - K)^+ = f(S_T),
$$
where $T$ is called the maturity date, $K$ is given and called the strike price, and $(x)^+ = \max\{x, 0\}$.
### Def 1.5 (Hedging)
A replication/hedging strategy is given by the following
$$
\varphi_t = (\alpha_t, \beta_t),
$$
where $\alpha_t$ is the amount of assets existing in the portfolio at time $t$, and $\beta_t$ is the amount of risk-free instruments $B_t$ in the portfolio at time $t$.
Note: $\alpha_t$ and $\beta_t$ can be negative, which corresponds to borrowing.
#### Example
Let $X$ be a derivative, for example 
$$
X = (S_1 - K)^+  = 
	\begin{cases}
	(S^u - K)^+ ,& \omega = \omega_1, \\
	(S^d - K)^+ ,& \omega = \omega_2.
	\end{cases}
$$
Let $x = V_1(\varphi)$ be the value of the portfolio. Let $\beta_0 = 1$. We have
$$
x = \alpha_1S_1 + \beta_1(1+r).
$$
Let $\alpha = \alpha_1$, and $\beta = \beta_1$. Looking for replication strategy $\varphi = (\alpha, \beta)$, we obtain the following equations:
$$
\begin{aligned}
\alpha S^u + \beta(1+r) &= x^u = (S^u - K)^+ \\
\alpha S^d + \beta(1+r) &= x^d = (S^d - K)^+.
\end{aligned}
$$
Then, solving for $\alpha$ and $\beta$, we have
$$
\alpha = \frac{x^u - x^d}{S^u - S^d}, \quad \beta = \frac{x^dS^u - x^uS^d}{(1 + r)(S^u - S^d)}.
$$
Hence the price equals
$$
\Pi(X) = \Pi_0(x) = \alpha S_0 + \beta.
$$
### Def 1.6 (Arbitrage)
We say that there is an arbitrage opportunity if there exists a portfolio $\varphi$ such that
$$
V_0(\varphi)(\omega) = 0, \quad V_T(\varphi)(\omega) \ge 0, \quad \forall \omega \in \Omega,
$$
and there exists $\omega \in \Omega$ such that $V_T(\varphi)(\omega) \gt 0$.
We want to consider only the markets without arbitrage opportunities.
### Theorem 1.1 (Two stage market)
The two stage market
$$
S_1(\omega) = 
	\begin{cases}
		S^u = S_0u,& \omega=\omega_1,\\
		S^d = S_0d,& \omega=\omega_2\\
	\end{cases}
$$
is arbitrage free iff
$$
S^d \lt (1+r)S_0 \lt S^u,
$$
or, in other words
$$
d \lt 1 + r \lt u.
$$
### Theorem 1.2 (Risk-neutral pricing formula)
The price of derivative $X$ at time $t=0$ is 
$$
\Pi_0(X) = E^Q\left[\frac{X}{(1+r)^T}\right],
$$
where $Q$ is the martingale/risk-neutral measure.
### Def 1.7 (Cox-Rubinstein (CRR) model)
Let $u=e^{\sigma\sqrt{\Delta t}}$, $d=e^{-\sigma\sqrt{\Delta t}}$, so that we have $u \cdot d = 1$, where $\Delta t$ is a fixed unit time and $\sigma$ is so-called volatility. The volatility can be estimated by
$$
\hat{\sigma} = \frac{1}{N-1}\sum_{i=1}^N(s_i - \bar{s})^2.
$$
# 2. General theory
### Def 2.1 (Market)
The market is a continuous-time stochastic process
$$
S_t = \left(S_t^0 = B_t, S_t^1, S_t^2, \dots, S_t^d\right),
$$
comprised of $d$ assets ($S_t^i$), and one risk-free instrument $B_t$.
### Def 2.2 (Investment strategy)
The investment strategy is a stochastic process
$$
\varphi_t = \left(\varphi_t^0, \varphi_t^1, \dots, \varphi_t^d\right),
$$
where $\varphi_t^i \in \mathbb{R}$ (negative values are meant as borrowing of assets) are predictable (generated by left-continuous processes) processes satisfying
$$
\int_0^TE\left[|\varphi_t^0|\right]dt \lt \infty, \quad \int_0^TE\left[|\varphi_t^i|^2\right]dt \lt \infty, \quad 1 \le i \le d,
$$
where $T$, the maturity date, can also be infinity.
### Def 2.3 (Value and gain process)
Define the value process $V_t(\varphi)$:
$$
V_t(\varphi) = \sum_{i=0}^d\varphi_t^iS_t^i = \varphi_t \bullet S_t,
$$
and the gain process $G_t(\varphi)$:
$$
G_t(\varphi) = \sum_{i=0}^d\int_0^t\varphi_t^idS_t^i.
$$

### Def 2.4 (Self-financing)
We say that the strategy $\varphi$ is self-financing if 
$$
V_t(\varphi) = V_0(\varphi) + G_t(\varphi).
$$
### Def 2.5 (Measure equivalence)
We say that measures $Q$ and $P$ are equivalent if
$$
P(A)=0 \iff Q(A)=0
$$
for every $A \in \mathbb{F}$.
By Radon-Nikodym theorem there exists a so-called density (non-negative martingale with mean $1$) process $L_t$
$$
\frac{dQ}{dP}\Bigg|_{F_t} = L_t.
$$
### Def 2.6 (Martingale measure)
Define the discounted asset price as $\tilde{S}_t^i = e^{-rt}S_t^i$.
$Q$ is a martingale (risk-neutral) measure if under $Q$, $\tilde{S}_t^i$ are martingales. Very often it is written as EMM (equivalent martingale measure).
### Def 2.7 (Arbitrage-free market)
The market is arbitrage-free if there are no arbitrage opportunities.
### Theorem 2.1 (First fundamental theorem)
Let $\mathcal{P}$ be a family of all risk-neutral measures. If $\mathcal{P} \ne \emptyset$ then the market is arbitrage-free.
### Def 2.8 (NFLVR - no free lunch with vanishing risk)
The strategy $\varphi_t = \varphi \cdot \mathbb{1}_{[t_1, t_2]}(t)$ is called a simple strategy where $t_1, t_2$ are stopping times. We say that simple strategy is $\delta$-admissible if 
$$
P(\tilde{V}_t(\varphi) \ge -\delta, \forall_{t\in[0,T]}) = 1.
$$
NFLVR holds if
$$
V_T(\varphi) \xrightarrow{P} 0, \text{ as } \delta \rightarrow 0.
$$
### Theorem 2.2 (NFLVR)
If NFLVR holds, then $\mathcal{P} \ne \emptyset$.
### Def 2.9 (Derivative)
$X$ if a derivative (claim), if
$$
X = F(S_T).
$$
### Def 2.10 (Hedging strategy)
$\varphi$ is a replicating/hedging strategy if
$$
V_T(\varphi)(\omega) = X(\omega), \quad \forall_{\omega \in \Omega}.
$$
### Theorem 2.3 (Risk-neutral (martingale) pricing formula)
The fair price of $X$ at time $t$ equals
$$
\Pi_t(X) = S_t^0E^Q\left[\frac{X}{S_T}\Bigg|\mathcal{F_t}\right],
$$
in particular, for $t=0$:
$$
\Pi_0(X) = e^{-rT}E^Q[X]. \text{ - W chuj wa≈ºne}
$$
### Def 2.11 (Complete market)
We say that a market is complete if there exists a strategy $\varphi$ such that $V_T(\varphi) = X$ for any derivative $X$.
### Theorem 2.4 (Second fundamental theorem)
If there exists a unique martingale measure, then the market is complete.

# 3. Black-Scholes model
### Def 3.1 (Black-Scholes model)
Let $S_t^0 = B_t = e^{rt}$, and let $S_t^i$ be such that they solve the following SDEs
$$
dS_t^i = S_t^i\left(b_i(t)dt + \sum_{j=1}^d\sigma_{ij}(t)dB_t^i\right),
$$
where $B_t^i$ are independent Brownian motions.
From now on we will assume that $d=1$, and that $b$ and $\sigma$ are constant, so that
$$
dS_t = bS_tdt + \sigma S_tdB_t.
$$
Note that
$$
d\tilde{S}_t = (b-r)\tilde{S}_tdt + \sigma\tilde{S}_tdB_t.
$$
### Theorem 3.1 (Girsanov theorem)
If $L_t = e^{\gamma B_t - \frac{1}{2}\gamma^2t} \in \mathcal{M}$ and 
$$
\frac{dQ}{dP}\Bigg|_{\mathcal{F}_t} = L_t,
$$
then $\tilde{B}_t = B_t + \gamma t$ is a brownian motion under measure $Q$. Hence, $B_t = \tilde{B}_t - \gamma t$.
Now, if we take $\gamma = \frac{b-r}{\sigma}$, then
$$
d\tilde{S}_t = \sigma \tilde{S}_t d\tilde{B}_t,
$$
hence there exists a unique martingale measure and there is no arbitrage and the market is complete.

Under $Q$ we have
$$
dS_t = rS_tdt + \sigma S_t d\tilde{B}_t,
$$
which is solved by
$$
S_t = S_0\exp\left(\left(r-\frac{\sigma}{2}\right)^2t + \sigma\tilde{B}_t\right).
$$
### Theorem 3.2 (Black-Scholes equation)
Let $X=H(S_T)$, and $\Pi_t(X) = F(t, S_t)$ for $t \in [0, T]$. Then $F(t, s)$ solves the following differential equation
$$
F_t + rsF_s + \frac{1}{2}\sigma^2s^2F_{ss} - rF = 0,
$$
with the terminal condition
$$
F(T, s) = H(s).
$$
### Theorem 3.3 (Hedging in a B-S market)
The hedging strategy in a B-S market is given. by $\varphi_t = \left(\varphi_t^0, \varphi_t^1\right)$, where
$$
\begin{aligned}
	\varphi_t^0 &= e^{-rt}\left(F(t, S_t) - S_tF_s(t, S_t)\right),\\
	\varphi_t^1 &= F_s(t, S_t).
\end{aligned}
$$
### Def 3.2 (European option)
The european call option is characterised by the payout function
$$
H(x) = (x - K)^+ = \max(\{x-K, 0\}),
$$
the european put option on the other hand has the following
$$
H(x) = (K-x)^+.
$$
$K$ is called the strike price.
### Theorem 3.4 (B-S formula for european call option)
The price of the european call option at time $t$ in B-S market is 
$$
C(t) = S_t\Phi(d_1) - Ke^{-r(T-t)}\Phi(d_2),
$$
where $\Phi(x)$ is the CDF of the standard gaussian distribution, and
$$
\begin{aligned}
d_1 &= \frac{\ln\left(\frac{S_t}{K}\right) + \left(\gamma + \frac{\sigma^2}{2}\right)(T-t)}{\sigma\sqrt{T-t}}, \\\\
d_2 &= d_1 - \sigma\sqrt{T-t}.
\end{aligned}
$$
# 4. Greeks (Sensitivity analysis)
### Def 4.1 (Delta)
Define 
$$
\Delta = \frac{\partial V}{\partial S}.
$$
It describes how big the change in the price of some derivative is in relation to small changes if initial price of the underlying.
